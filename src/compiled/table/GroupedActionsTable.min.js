define(function(require){"use strict";var BaseTable=require("drc/table/BaseTable.min"),$=require("jquery"),_=require("lodash"),React=require("react"),Utils=require("drc/utils/Utils.min"),GroupedActionsTable={clobberBaseTable:{getTableRowItem:function(rowData,index){var rows=[],rowDataElements=[],subRowIndex=0,dataIndex=0,nestedDataIndex=0;return _.forIn(this.state.colDefinitions,function(val){rowDataElements.push(this.getTableData(rowData,val,dataIndex++))}.bind(this)),rows.push(React.createElement("tr",{"data-index":index,key:"tableRow"+index,className:"hover-enabled text-select",onClick:this.handleGroupRowClick},rowDataElements)),this.state.selectedIndex===index&&_.each(rowData.actions,function(action){var subRowData=[];_.forIn(this.state.colDefinitions,function(val){subRowData.push(this.getNestedRowTableData(action,val,nestedDataIndex++))}.bind(this)),rows.push(React.createElement("tr",{"data-flowid":action.flowID,key:"tableSubRow"+subRowIndex++,className:"hover-enabled text-select sub-action",onClick:this.handleRowClick},subRowData))},this),rows},getTableData:function(rowData,meta,index){var beforeVal,statusIconClasses,expandedRowIndicatorClasses,val=rowData[meta.dataProperty],spanClasses=Utils.classSet({content:!0,"group-date":"groupDate"===meta.dataProperty});return"duration"===meta.dataProperty?val=this.calculateDurationString(val):"groupDate"===meta.dataProperty&&(statusIconClasses=this.state.selectedIndex===index?this.iconClasses.rowsExpanded:this.iconClasses.rowsCollapsed,expandedRowIndicatorClasses=Utils.classSet({"before-icon":!0,"expanded-row-indicator":!0,inactive:this.state.selectedIndex!==index}),beforeVal=React.createElement("span",{className:expandedRowIndicatorClasses},rowData.actions.length,React.createElement("i",{className:statusIconClasses}))),React.createElement("td",{key:"tableData"+index},beforeVal,React.createElement("span",{className:spanClasses,title:val},val))}},addToBaseTable:{componentDidUpdate:function(){this.state.selectedIndex>-1&&$("tr.sub-action").find("td").wrapInner('<div class="wrap-inner" />').parent().show().find("td > div").slideDown(200,function(){var $set=$(this);$set.replaceWith($set.contents())})},getNestedRowTableData:function(action,meta,index){var val="--",spanClasses=Utils.classSet({content:!0,"nested-text":"groupDate"===meta.dataProperty});if(!action.start||!action.end)return null;switch(meta.dataProperty){case"groupDate":val=Utils.calculateTimeString(action.start,action.end);break;case"duration":val=this.calculateDurationString(new Date(action.end).getTime()-new Date(action.start).getTime());break;case"totalCount":val=action.actionCount}return React.createElement("td",{key:"nestedTableData"+index},React.createElement("span",{className:spanClasses,title:val},val))},calculateDurationString:function(interval){return String(Math.max(1,Math.ceil(interval/60/1e3)))+"m"},handleGroupRowClick:function(e){var index=$(e.currentTarget).data("index");this.setState({selectedIndex:this.state.selectedIndex===index?-1:index})}}};return Utils.extendReactClass(BaseTable,GroupedActionsTable.clobberBaseTable,GroupedActionsTable.addToBaseTable)});
