define(function(require){"use strict";var BaseTable=require("drc/table/BaseTable.min"),_=require("lodash"),React=(require("moment"),require("react")),Utils=require("drc/utils/Utils.min"),GroupedActionsTable={clobberBaseTable:{getTableRowItem:function(rowData,index){var rows=[],rowDataElements=[];return _.forIn(this.state.colDefinitions,function(val,key){rowDataElements.push(this.getTableData(rowData,val,index))}.bind(this)),rows.push(React.createElement("tr",{"data-index":index,key:"tableRow"+Utils.guid(),className:"hover-enabled text-select",onClick:this.handleGroupRowClick},rowDataElements)),this.state.selectedIndex===index&&_.each(rowData.actions,function(action){var subRowData=[];_.forIn(this.state.colDefinitions,function(val,key){subRowData.push(this.getNestedRowTableData(action,val))}.bind(this)),rows.push(React.createElement("tr",{"data-flowid":action.flowID,key:"tableRow"+Utils.guid(),className:"hover-enabled text-select sub-action",onClick:this.handleRowClick},subRowData))},this),rows},getTableData:function(rowData,meta,index){var beforeVal,statusIconClasses,expandedRowIndicatorClasses,val=rowData[meta.dataProperty],spanClasses=React.addons.classSet({content:!0,"group-date":"groupDate"===meta.dataProperty});return"duration"===meta.dataProperty?val=this.calculateDurationString(val):"groupDate"===meta.dataProperty&&(statusIconClasses=this.state.selectedIndex===index?this.iconClasses.rowsExpanded:this.iconClasses.rowsCollapsed,expandedRowIndicatorClasses=React.addons.classSet({"before-icon":!0,"expanded-row-indicator":!0,inactive:this.state.selectedIndex!==index}),beforeVal=React.createElement("span",{className:expandedRowIndicatorClasses},rowData.actions.length,React.createElement("i",{className:statusIconClasses}))),React.createElement("td",{key:"tableData"+Utils.guid()},beforeVal,React.createElement("span",{className:spanClasses,title:val},val))}},addToBaseTable:{componentDidUpdate:function(){this.state.selectedIndex>-1&&$("tr.sub-action").find("td").wrapInner('<div class="wrap-inner" />').parent().show().find("td > div").slideDown(200,function(){var $set=$(this);$set.replaceWith($set.contents())})},getNestedRowTableData:function(action,meta){var val="--",spanClasses=React.addons.classSet({content:!0,"nested-text":"groupDate"===meta.dataProperty});if(action.start&&action.end){switch(meta.dataProperty){case"groupDate":val=Utils.calculateTimeString(action.start,action.end);break;case"duration":val=this.calculateDurationString(new Date(action.end).getTime()-new Date(action.start).getTime());break;case"totalCount":val=action.actionCount}return React.createElement("td",{key:"tableData"+Utils.guid()},React.createElement("span",{className:spanClasses,title:val},val))}},calculateDurationString:function(interval){return String(Math.max(1,Math.ceil(interval/60/1e3)))+"m"},handleGroupRowClick:function(e){var index=$(e.currentTarget).data("index");this.setState({selectedIndex:this.state.selectedIndex===index?-1:index})}}};return Utils.extendReactClass(BaseTable,GroupedActionsTable.clobberBaseTable,GroupedActionsTable.addToBaseTable)});
